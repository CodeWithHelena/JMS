<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Journals | JournalFlow - Academic Journal Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">

    <link rel="stylesheet" href="style.css">

    <style>
        :root {
            --background: #ffffff;
            --foreground: #030712;
            --card: #ffffff;
            --card-foreground: #030712;

            /* === NEW MAIN BRAND COLORS === */
            --primary: #1F1B51;
            /* hsl(243 50% 22%) */
            --primary-dark: #17133D;
            /* hsl(243 55% 18%) - darker #1F1B51 */
            --primary-light: #F5F4FE;
            /* hsl(243 50% 96%) */

            --lite-secondary1: #0E6BA7;
            /* hsl(205 78% 35%) */
            --lite-secondary2: #00BFFF;
            /* hsl(195 100% 50%) */

            --primary-foreground: #ffffff;

            --secondary: #f1f5f9;
            --secondary-foreground: #0f172a;

            --muted: #f1f5f9;
            --muted-foreground: #64748b;

            --accent: #f1f5f9;
            --accent-foreground: #0f172a;

            --destructive: #ef4444;
            --border: #e2e8f0;
            --input: #e2e8f0;

            --ring: #1F1B51;
            /* matches primary */
            --radius: 0.5rem;
        }


        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--foreground);
            background-color: var(--background);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            width: 100%;
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }



        /* Page Header */
        .page-header {
            background: linear-gradient(135deg, rgba(31, 27, 81, 0.05) 0%, transparent 100%);
            padding: 3rem 0;
            border-bottom: 1px solid var(--border);
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            color: var(--foreground);
        }

        .page-subtitle {
            font-size: 1.125rem;
            color: var(--muted-foreground);
            max-width: 800px;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            border-radius: var(--radius);
            font-weight: 500;
            padding: 0.75rem 1.5rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
            text-decoration: none;
        }

        .btn-primary {
            background-color: var(--primary);
            color: var(--primary-foreground);
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(31, 27, 81, 0.3);
        }

        .btn-outline {
            background-color: transparent;
            color: var(--primary);
            border: 1px solid var(--border);
        }

        .btn-outline:hover {
            background-color: var(--accent);
            border-color: var(--primary);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        .btn-lg {
            padding: 1rem 2rem;
            font-size: 1.125rem;
        }

        /* Auth buttons */
        .auth-buttons {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .btn-signin {
            background-color: var(--primary);
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: var(--radius);
            text-decoration: none;
            font-weight: 500;
            transition: background-color 0.2s;
        }

        .btn-signin:hover {
            background-color: var(--primary-dark);
        }

        .btn-register {
            background-color: transparent;
            color: var(--primary);
            border: 1px solid var(--primary);
            padding: 0.5rem 1.5rem;
            border-radius: var(--radius);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-register:hover {
            background-color: rgba(31, 27, 81, 0.1);
        }

        /* Custom Select Styles */
        .page-controls {
            padding: 2rem 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .filter-group {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
        }

        .search-box {
            position: relative;
            max-width: 300px;
        }

        .search-input {
            width: 100%;
            padding: 0.625rem 1rem 0.625rem 2.5rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background-color: var(--background);
            color: var(--foreground);
            font-size: 0.875rem;
            transition: border-color 0.2s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(31, 27, 81, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--muted-foreground);
        }

        .custom-select {
            position: relative;
            min-width: 180px;
        }

        .select-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.625rem 1rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background-color: var(--background);
            cursor: pointer;
            user-select: none;
            transition: all 0.2s;
        }

        .select-header:hover {
            border-color: var(--primary);
        }

        .select-header.active {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(31, 27, 81, 0.1);
        }

        .select-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: var(--foreground);
        }

        .select-label .placeholder {
            color: var(--muted-foreground);
        }

        .select-chevron {
            transition: transform 0.2s;
        }

        .select-header.active .select-chevron {
            transform: rotate(180deg);
        }

        .select-dropdown {
            position: absolute;
            top: calc(100% + 0.25rem);
            left: 0;
            right: 0;
            background-color: var(--background);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            z-index: 50;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

        .select-dropdown.active {
            display: block;
            animation: fadeIn 0.2s ease;
        }

        .select-option {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .select-option:hover {
            background-color: var(--accent);
        }

        .select-option.selected {
            background-color: rgba(31, 27, 81, 0.1);
            color: var(--primary);
            font-weight: 500;
        }

        .select-option.selected .checkmark {
            display: block;
        }

        .select-option .checkmark {
            display: none;
            color: var(--primary);
        }

        .stats-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: var(--muted-foreground);
            font-size: 0.875rem;
        }

        .active-filter {
            background-color: var(--primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius);
            font-size: 0.75rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .active-filter i {
            cursor: pointer;
            font-size: 0.625rem;
            padding-left: 0.25rem;
        }

        /* Journals Grid */
        .journals-container {
            padding: 2rem 0 4rem;
            flex-grow: 1;
        }

        .journals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .journal-card {
            background-color: var(--card);
            border-radius: var(--radius);
            border: 1px solid var(--border);
            overflow: hidden;
            transition: all 0.3s ease;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .journal-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .journal-header {
            padding: 1.5rem 1.5rem 0.5rem;
        }

        .journal-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background-color: rgba(0, 191, 255, 0.1);
            color: var(--lite-secondary2);
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-bottom: 1rem;
        }

        .journal-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            line-height: 1.3;
            color: var(--foreground);
        }

        .journal-issn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--muted-foreground);
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .journal-content {
            padding: 0 1.5rem 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .journal-description {
            color: var(--muted-foreground);
            margin-bottom: 1.5rem;
            line-height: 1.6;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .journal-details {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
        }

        .detail-label {
            color: var(--muted-foreground);
        }

        .detail-value {
            font-weight: 500;
            color: var(--foreground);
        }

        .journal-indexing {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        .indexing-label {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--muted-foreground);
            margin-bottom: 0.5rem;
        }

        .indexing-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .indexing-badge {
            background-color: rgba(14, 107, 167, 0.1);
            color: var(--lite-secondary1);
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius);
            font-size: 0.75rem;
            font-weight: 500;
            border: 1px solid rgba(14, 107, 167, 0.2);
        }

        .journal-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border);
            background-color: rgba(241, 245, 249, 0.5);
            margin-top: auto;
        }

        .journal-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .status-active {
            color: #10b981;
            font-weight: 500;
        }

        .status-inactive {
            color: #ef4444;
            font-weight: 500;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin-top: 3rem;
        }

        .pagination-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: var(--radius);
            background-color: transparent;
            border: 1px solid var(--border);
            color: var(--foreground);
            cursor: pointer;
            transition: all 0.2s;
        }

        .pagination-btn:hover {
            background-color: var(--accent);
            border-color: var(--primary);
        }

        .pagination-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-btn:disabled:hover {
            background-color: transparent;
            border-color: var(--border);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 1rem;
        }

        .empty-state i {
            font-size: 4rem;
            color: var(--muted-foreground);
            margin-bottom: 1.5rem;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--foreground);
        }

        .empty-state p {
            color: var(--muted-foreground);
            max-width: 500px;
            margin: 0 auto 1.5rem;
        }



        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background-color: var(--background);
                flex-direction: column;
                padding: 1.5rem;
                border-bottom: 1px solid var(--border);
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            }

            .nav-links.active {
                display: flex;
            }

            .mobile-menu-btn {
                display: block;
            }

            .page-title {
                font-size: 2rem;
            }

            .journals-grid {
                grid-template-columns: 1fr;
            }

            .page-controls {
                flex-direction: column;
                align-items: flex-start;
            }

            .filter-group {
                width: 100%;
                flex-direction: column;
                align-items: stretch;
            }

            .search-box,
            .custom-select {
                max-width: 100%;
                width: 100%;
            }

            .auth-buttons {
                flex-direction: column;
                width: 100%;
            }

            .auth-buttons a {
                width: 100%;
                text-align: center;
            }
        }

        @media (max-width: 1024px) {
            .journals-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            }
        }

        /* Animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.6s ease forwards;
        }

        .stagger-delay-1 {
            animation-delay: 0.1s;
        }

        .stagger-delay-2 {
            animation-delay: 0.2s;
        }

        .stagger-delay-3 {
            animation-delay: 0.3s;
        }

        /* Loading state */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header id="header">
    </header>
    <script src="js/header.js"></script>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <div class="fade-in">
                <h1 class="page-title">All Academic Journals</h1>
                <p class="page-subtitle">Browse and explore all academic journals managed on the JournalFlow platform. Filter by subject, review policy, or status to find the journals relevant to your research.</p>
            </div>
        </div>
    </section>

    <!-- Page Controls -->
    <section class="page-controls">
        <div class="container">
            <div class="filter-group">
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="searchInput" class="search-input" placeholder="Search journals by title, publisher, or scope...">
                </div>

                <!-- Custom Select for Scope -->
                <div class="custom-select" id="scopeSelect">
                    <div class="select-header">
                        <div class="select-label">
                            <i class="fas fa-tags"></i>
                            <span class="select-value" data-placeholder="All Scopes">All Scopes</span>
                        </div>
                        <i class="fas fa-chevron-down select-chevron"></i>
                    </div>
                    <div class="select-dropdown">
                        <div class="select-option" data-value="">All Scopes</div>
                        <div class="select-option" data-value="Agriculture">Agriculture</div>
                        <div class="select-option" data-value="Medical Sciences">Medical Sciences</div>
                        <div class="select-option" data-value="Computer Science">Computer Science</div>
                        <div class="select-option" data-value="Environmental Science">Environmental Science</div>
                        <div class="select-option" data-value="Business & Economics">Business & Economics</div>
                        <div class="select-option" data-value="Engineering">Engineering</div>
                        <div class="select-option" data-value="Psychology">Psychology</div>
                        <div class="select-option" data-value="Chemical Engineering">Chemical Engineering</div>
                    </div>
                </div>

                <!-- Custom Select for Status -->
                <div class="custom-select" id="statusSelect">
                    <div class="select-header">
                        <div class="select-label">
                            <i class="fas fa-circle"></i>
                            <span class="select-value" data-placeholder="All Statuses">All Statuses</span>
                        </div>
                        <i class="fas fa-chevron-down select-chevron"></i>
                    </div>
                    <div class="select-dropdown">
                        <div class="select-option" data-value="">All Statuses</div>
                        <div class="select-option" data-value="active">Active</div>
                        <div class="select-option" data-value="inactive">Inactive</div>
                    </div>
                </div>

                <!-- Custom Select for Review Policy -->
                <div class="custom-select" id="reviewSelect">
                    <div class="select-header">
                        <div class="select-label">
                            <i class="fas fa-eye"></i>
                            <span class="select-value" data-placeholder="All Review Policies">All Review Policies</span>
                        </div>
                        <i class="fas fa-chevron-down select-chevron"></i>
                    </div>
                    <div class="select-dropdown">
                        <div class="select-option" data-value="">All Review Policies</div>
                        <div class="select-option" data-value="single-blind">Single-Blind</div>
                        <div class="select-option" data-value="double-blind">Double-Blind</div>
                        <div class="select-option" data-value="open">Open</div>
                    </div>
                </div>
            </div>

            <div class="stats-info">
                <span id="resultsCount">Loading journals...</span>
                <div id="activeFilters" style="display: none;">
                    <span class="active-filter">
                        Filter: <span id="filterText"></span>
                        <i class="fas fa-times" onclick="clearFilters()"></i>
                    </span>
                </div>
            </div>
        </div>
    </section>

    <!-- Journals Container -->
    <main class="journals-container">
        <div class="container">
            <div id="journalsGrid" class="journals-grid">
                <!-- Journals will be loaded dynamically here -->
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="empty-state" style="display: none;">
                <i class="fas fa-book-open"></i>
                <h3>No journals found</h3>
                <p>Try adjusting your search or filter to find what you're looking for.</p>
                <button class="btn btn-outline" onclick="clearFilters()">
                    <i class="fas fa-filter"></i> Clear All Filters
                </button>
            </div>

            <!-- Pagination -->
            <div id="pagination" class="pagination">
                <!-- Pagination will be generated dynamically -->
            </div>
        </div>
    </main>

    <footer id="footer">

    </footer>
    <script src="js/footer.js"></script>

    <script type="module">
import { BASE_URL } from '../assets/js/utility.js';

// DOM
const journalsGrid = document.getElementById('journalsGrid');
const searchInput = document.getElementById('searchInput');
const resultsCount = document.getElementById('resultsCount');
const activeFilters = document.getElementById('activeFilters');
const filterText = document.getElementById('filterText');
const emptyState = document.getElementById('emptyState');
const pagination = document.getElementById('pagination');
const mobileMenuBtn = document.getElementById('mobileMenuBtn');
const navLinks = document.querySelector('.nav-links');

const scopeSelect = document.getElementById('scopeSelect');
const statusSelect = document.getElementById('statusSelect');
const reviewSelect = document.getElementById('reviewSelect');

// State
let journalsData = []; // current page items from API
let currentFilters = { search: '', scope: '', status: '', review: '' };
let currentPage = 1;
const journalsPerPage = 6; // page size shown on UI
let totalPages = 1;
let totalItems = 0;

// Helpers
function normalizeJournal(apiJournal) {
let id = apiJournal._id ?? '';
if (typeof id === 'string') id = { $oid: id };
else if (typeof id === 'object' && !id.$oid) id = { $oid: String(id) };
return { ...apiJournal, _id: id };
}

function formatCurrency(amount, currency) {
try {
return new Intl.NumberFormat('en-US', {
style: 'currency',
currency: currency || 'USD',
minimumFractionDigits: 0,
maximumFractionDigits: 0
}).format(amount);
} catch {
return `${amount} ${currency || ''}`;
}
}

function formatReviewPolicy(policy) {
if (!policy) return '';
return policy.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join('-');
}

function createJournalCard(journal) {
const idValue = journal._id && (journal._id.$oid || journal._id);
return `
<div class="journal-card fade-in">
    <div class="journal-header">
        <span class="journal-badge">${journal.scope || ''}</span>
        <h3 class="journal-title">${journal.title || ''}</h3>
        <div class="journal-issn">
            <i class="fas fa-globe"></i>
            <span>ISSN: ${journal.issn || 'N/A'}</span>
        </div>
    </div>
    <div class="journal-content">
        <p class="journal-description">${journal.description || ''}</p>
        <div class="journal-details">
            <div class="detail-row">
                <span class="detail-label">Publisher:</span>
                <span class="detail-value">${journal.publisher || ''}</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Review Policy:</span>
                <span class="detail-value">${formatReviewPolicy(journal.reviewPolicy || '')}</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Publication Fee:</span>
                <span class="detail-value">${(journal.publicationFee || journal.publicationFee === 0) ? formatCurrency(journal.publicationFee, journal.currency) : 'N/A'}</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Submission Fee:</span>
                <span class="detail-value">${(journal.submissionFee === 0) ? 'Free' : (journal.submissionFee ? formatCurrency(journal.submissionFee, journal.currency) : 'N/A')}</span>
            </div>
        </div>
        ${journal.indexing && journal.indexing.length ? `
        <div class="journal-indexing">
            <div class="indexing-label">Indexed In:</div>
            <div class="indexing-badges">
                ${journal.indexing.map(i => `<span class="indexing-badge">${i.name}</span>`).join('')}
            </div>
        </div>` : ''}
    </div>
    <div class="journal-footer">
        <div class="journal-status">
            <i class="fas fa-circle ${journal.isActive ? 'status-active' : 'status-inactive'}"></i>
            <span class="${journal.isActive ? 'status-active' : 'status-inactive'}">${journal.isActive ? 'Active' : 'Inactive'}</span>
        </div>
        <button class="btn btn-primary btn-sm" onclick="viewJournal('${idValue}')">
            <i class="fas fa-external-link-alt"></i> View Details
        </button>
    </div>
</div>
`;
}

// Render results & pagination
function renderJournals() {
// UI text
resultsCount.textContent = totalItems > 0
? `Showing ${(currentPage - 1) * journalsPerPage + 1}-${Math.min(currentPage * journalsPerPage, totalItems)} of ${totalItems} journals`
: 'No journals found';

if (!journalsData.length) {
journalsGrid.style.display = 'none';
emptyState.style.display = 'block';
pagination.style.display = 'none';
return;
}

journalsGrid.style.display = 'grid';
emptyState.style.display = 'none';
pagination.style.display = 'flex';

journalsGrid.innerHTML = '';
journalsData.forEach((j, idx) => {
const wrapper = document.createElement('div');
wrapper.innerHTML = createJournalCard(j);
const el = wrapper.firstElementChild;
el.style.animationDelay = `${idx * 0.06}s`;
el.classList.add('fade-in');
journalsGrid.appendChild(el);
});

renderPagination(totalPages);
}

function renderPagination(pages) {
let out = '';
out += `<button class="pagination-btn" ${currentPage===1 ? 'disabled' : '' } onclick="changePage(${currentPage - 1})"><i class="fas fa-chevron-left"></i></button>`;

const maxVisible = 5;
let start = Math.max(1, currentPage - Math.floor(maxVisible / 2));
let end = Math.min(pages, start + maxVisible - 1);
if (end - start + 1 < maxVisible) start=Math.max(1, end - maxVisible + 1); for (let i=start; i <=end; i++) { out +=`<button class="pagination-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
    }

    out += `<button class="pagination-btn" ${currentPage===pages ? 'disabled' : '' } onclick="changePage(${currentPage + 1})"><i class="fas fa-chevron-right"></i></button>`;
    pagination.innerHTML = out;
    }

    // Build API endpoint with current filters & page
    function buildEndpoint(page = 1) {
    const params = new URLSearchParams();
    params.set('page', page);
    params.set('limit', journalsPerPage);

    // include filters as query params (backend may or may not support them; harmless if ignored)
    if (currentFilters.search) params.set('search', currentFilters.search);
    if (currentFilters.scope) params.set('scope', currentFilters.scope);
    if (currentFilters.status) params.set('status', currentFilters.status);
    if (currentFilters.review) params.set('review', currentFilters.review);

    return `${BASE_URL}/journal?${params.toString()}`;
    }

    // Fetch page from API
    async function fetchPage(page = 1) {
    currentPage = page;
    const endpoint = buildEndpoint(page);

    // loading UI
    journalsGrid.innerHTML = `<div style="padding:2rem; text-align:center;"><i class="fas fa-spinner fa-spin"></i> Loading journals...</div>`;
    resultsCount.textContent = 'Loading journals...';
    emptyState.style.display = 'none';
    pagination.style.display = 'none';

    try {
    const res = await fetch(endpoint, { method: 'GET', headers: { 'Content-Type': 'application/json' }});
    if (!res.ok) throw new Error(`API ${res.status}`);

    const data = await res.json();

    // expected keys: journals (array), page, pages, total
    const apiJournals = Array.isArray(data.journals) ? data.journals : [];
    journalsData = apiJournals.map(normalizeJournal);
    totalPages = data.pages ?? (data.total ? Math.ceil(data.total / journalsPerPage) : 1);
    totalItems = data.total ?? journalsData.length ?? 0;

    // if backend returns only page items and total, we use them; else fallback
    renderJournals();
    } catch (err) {
    console.error('Fetch journals failed', err);
    journalsData = [];
    totalPages = 1;
    totalItems = 0;
    journalsGrid.innerHTML = `<div style="padding:2rem; text-align:center; color:var(--muted-foreground)">Unable to load journals. Please check your connection.</div>`;
    resultsCount.textContent = 'Unable to load journals';
    }
    }

    // Filters & select handling
    function applyFiltersAndFetch() {
    currentFilters.search = (searchInput.value || '').trim();
    currentFilters.scope = scopeCustomSelect.getValue();
    currentFilters.status = statusCustomSelect.getValue();
    currentFilters.review = reviewCustomSelect.getValue();

    // Update active filters UI
    const parts = [];
    if (currentFilters.search) parts.push(`Search: "${currentFilters.search}"`);
    if (currentFilters.scope) parts.push(`Scope: ${currentFilters.scope}`);
    if (currentFilters.status) parts.push(`Status: ${currentFilters.status === 'active' ? 'Active' : 'Inactive'}`);
    if (currentFilters.review) parts.push(`Review: ${formatReviewPolicy(currentFilters.review)}`);

    if (parts.length) {
    filterText.textContent = parts.join(', ');
    activeFilters.style.display = 'block';
    } else {
    activeFilters.style.display = 'none';
    }

    // fetch page 1 with filters
    fetchPage(1);
    }

    // Clear filters (exposed globally)
    window.clearFilters = function () {
    if (searchInput) searchInput.value = '';
    if (scopeCustomSelect) scopeCustomSelect.reset();
    if (statusCustomSelect) statusCustomSelect.reset();
    if (reviewCustomSelect) reviewCustomSelect.reset();
    applyFiltersAndFetch();
    };

    // Pagination controls (exposed globally)
    window.changePage = function (page) {
    if (page < 1 || page> totalPages) return;
        fetchPage(page);
        };

        // View details (keeps previous behavior)
        window.viewJournal = function (journalId) {
        const j = journalsData.find(x => {
        const id = x._id && (x._id.$oid || x._id);
        return String(id) === String(journalId);
        });
        if (j) {
        alert(`Journal Details:\n\nTitle: ${j.title}\nPublisher: ${j.publisher}\nISSN: ${j.issn}\nScope: ${j.scope}\nEmail: ${j.email}\nStatus: ${j.isActive ? 'Active' : 'Inactive'}`);
        }
        };

        // CustomSelect class (unchanged from your implementation)
        class CustomSelect {
        constructor(element) {
        this.element = element;
        this.header = element.querySelector('.select-header');
        this.valueElement = element.querySelector('.select-value');
        this.dropdown = element.querySelector('.select-dropdown');
        this.options = element.querySelectorAll('.select-option');
        this.selectedValue = '';
        this.placeholder = this.valueElement.getAttribute('data-placeholder');
        this.init();
        }
        init() {
        this.header.addEventListener('click', e => { e.stopPropagation(); this.toggle(); });
        this.options.forEach(option => option.addEventListener('click', () => { this.select(option.getAttribute('data-value'), option.textContent); this.close(); }));
        document.addEventListener('click', () => this.close());
        this.dropdown.addEventListener('click', e => e.stopPropagation());
        }
        toggle() { this.dropdown.classList.contains('active') ? this.close() : this.open(); }
        open() {
        this.closeAllSelects();
        this.header.classList.add('active');
        this.dropdown.classList.add('active');
        this.element.style.zIndex = '60';
        this.options.forEach(opt => { opt.classList.remove('selected'); if (opt.getAttribute('data-value') === this.selectedValue) opt.classList.add('selected'); });
        }
        close() { this.header.classList.remove('active'); this.dropdown.classList.remove('active'); this.element.style.zIndex = ''; }
        select(value, displayText) {
        this.selectedValue = value;
        if (value === '') { this.valueElement.textContent = this.placeholder; this.valueElement.classList.add('placeholder'); }
        else { this.valueElement.textContent = displayText; this.valueElement.classList.remove('placeholder'); }
        this.options.forEach(o => o.classList.toggle('selected', o.getAttribute('data-value') === value));
        }
        getValue() { return this.selectedValue; }
        reset() { this.select('', this.placeholder); }
        closeAllSelects() {
        document.querySelectorAll('.custom-select').forEach(select => {
        const header = select.querySelector('.select-header');
        const dropdown = select.querySelector('.select-dropdown');
        header.classList.remove('active');
        dropdown.classList.remove('active');
        select.style.zIndex = '';
        });
        }
        }

        /* Initialize on DOMContentLoaded */
        let scopeCustomSelect, statusCustomSelect, reviewCustomSelect;
        document.addEventListener('DOMContentLoaded', () => {
        if (scopeSelect) scopeCustomSelect = new CustomSelect(scopeSelect);
        if (statusSelect) statusCustomSelect = new CustomSelect(statusSelect);
        if (reviewSelect) reviewCustomSelect = new CustomSelect(reviewSelect);

        // trigger fetch on select changes â€” override select to call applyFiltersAndFetch
        const origSelect = CustomSelect.prototype.select;
        CustomSelect.prototype.select = function (v, t) { origSelect.call(this, v, t); setTimeout(applyFiltersAndFetch, 0); };

        if (searchInput) searchInput.addEventListener('input', debounce(() => applyFiltersAndFetch(), 350));

        // close selects clicking outside
        document.addEventListener('click', (e) => { if (!e.target.closest('.custom-select')) document.querySelectorAll('.custom-select').forEach(s => { s.querySelector('.select-header').classList.remove('active'); s.querySelector('.select-dropdown').classList.remove('active'); s.style.zIndex = ''; }) });

        if (mobileMenuBtn) mobileMenuBtn.addEventListener('click', () => {
        if (!navLinks) return;
        navLinks.classList.toggle('active');
        const icon = mobileMenuBtn.querySelector('i');
        if (navLinks.classList.contains('active')) { icon.classList.remove('fa-bars'); icon.classList.add('fa-times'); }
        else { icon.classList.remove('fa-times'); icon.classList.add('fa-bars'); }
        });

        // initial load
        applyFiltersAndFetch();
        });

        // small debounce helper
        function debounce(fn, wait) {
        let t;
        return (...args) => { clearTimeout(t); t = setTimeout(() => fn(...args), wait); };
        }

    </script>
</body>

</html>