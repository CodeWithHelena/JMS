<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Latest Issues </title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" />

  <link rel="stylesheet" href="style.css">
  <style>
    :root {
      --background: #ffffff;
      --foreground: #030712;
      --card: #ffffff;
      --card-foreground: #030712;

      /* === NEW MAIN BRAND COLORS === */
      --primary: #1F1B51;
      /* hsl(243 50% 22%) */
      --primary-dark: #17133D;
      /* hsl(243 55% 18%) - darker #1F1B51 */
      --primary-light: #F5F4FE;
      /* hsl(243 50% 96%) */

      --lite-secondary1: #0E6BA7;
      /* hsl(205 78% 35%) */
      --lite-secondary2: #00BFFF;
      /* hsl(195 100% 50%) */

      --primary-foreground: #ffffff;

      --secondary: #f1f5f9;
      --secondary-foreground: #0f172a;

      --muted: #f1f5f9;
      --muted-foreground: #64748b;

      --accent: #f1f5f9;
      --accent-foreground: #0f172a;

      --destructive: #ef4444;
      --border: #e2e8f0;
      --input: #e2e8f0;

      --ring: #1F1B51;
      /* matches primary */
      --radius: 0.5rem;
    }


    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Inter", sans-serif;
      line-height: 1.6;
      color: var(--foreground);
      background-color: var(--background);
    }

    .container {
      width: 100%;
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 1.5rem;
    }

    /* Page Hero */
    .page-hero {
      padding: 5rem 0 3rem;
      background: linear-gradient(135deg,
          rgba(31, 27, 81, 0.05) 0%,
          transparent 100%);
      text-align: center;
    }

    .page-hero-content {
      max-width: 800px;
      margin: 0 auto;
    }

    .page-hero h1 {
      font-size: 3.5rem;
      font-weight: 800;
      line-height: 1.1;
      margin-bottom: 1.5rem;
      background: linear-gradient(to right,
          var(--primary),
          var(--lite-secondary1));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .page-hero p {
      font-size: 1.25rem;
      color: var(--muted-foreground);
      margin-bottom: 2rem;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }

    /* Breadcrumb */
    .breadcrumb {
      margin-bottom: 2rem;
      font-size: 0.875rem;
      color: var(--muted-foreground);
    }

    .breadcrumb a {
      color: var(--primary);
      text-decoration: none;
    }

    .breadcrumb a:hover {
      text-decoration: underline;
    }

    /* Filters Section */
    .filters-section {
      background-color: var(--card);
      border-radius: var(--radius);
      padding: 2rem;
      border: 1px solid var(--border);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
      margin-top: -2rem;
      position: relative;
      z-index: 10;
    }

    .filters-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .filter-group label {
      font-weight: 500;
      color: var(--foreground);
      font-size: 0.875rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .search-box {
      position: relative;
    }

    .search-box input {
      width: 100%;
      padding: 0.8rem 1rem 0.8rem 3rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-family: "Inter", sans-serif;
      font-size: 0.875rem;
      transition: border-color 0.2s;
    }

    .search-box input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(31, 27, 81, 0.1);
    }

    .search-box i {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--muted-foreground);
    }

    /* Custom Dropdown */
    .custom-dropdown {
      position: relative;
      width: 100%;
    }

    .dropdown-toggle {
      width: 100%;
      padding: 0.8rem 1rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background-color: var(--background);
      text-align: left;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.875rem;
      transition: border-color 0.2s;
    }

    .dropdown-toggle:hover {
      border-color: var(--primary);
    }

    .dropdown-toggle.active {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(31, 27, 81, 0.1);
    }

    .dropdown-menu {
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      background-color: var(--background);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      margin-top: 0.25rem;
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      max-height: 300px;
      overflow-y: auto;
      display: none;
    }

    .dropdown-menu.show {
      display: block;
    }

    .dropdown-search {
      padding: 0.75rem;
      border-bottom: 1px solid var(--border);
    }

    .dropdown-search input {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border: 1px solid var(--border);
      border-radius: calc(var(--radius) - 0.25rem);
      font-size: 0.875rem;
    }

    .dropdown-search input:focus {
      outline: none;
      border-color: var(--primary);
    }

    .dropdown-item {
      padding: 0.75rem 1rem;
      cursor: pointer;
      transition: all 0.2s;
      border-bottom: 1px solid rgba(226, 232, 240, 0.5);
      font-size: 0.875rem;
    }

    .dropdown-item:last-child {
      border-bottom: none;
    }

    .dropdown-item:hover {
      background-color: var(--accent);
    }

    .dropdown-item.selected {
      background-color: rgba(31, 27, 81, 0.1);
      color: var(--primary);
      font-weight: 500;
    }

    .filter-actions {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--border);
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      border-radius: var(--radius);
      font-weight: 500;
      padding: 0.75rem 1.5rem;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 1rem;
      text-decoration: none;
    }

    .btn-primary {
      background-color: var(--primary);
      color: var(--primary-foreground);
    }

    .btn-primary:hover {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 10px 25px -5px rgba(31, 27, 81, 0.3);
    }

    .btn-outline {
      background-color: transparent;
      color: var(--primary);
      border: 1px solid var(--border);
    }

    .btn-outline:hover {
      background-color: var(--accent);
      border-color: var(--primary);
    }

    .btn-sm {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
    }

    /* Issues Grid */
    .issues-section {
      padding: 3rem 0 5rem;
    }

    .issues-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }

    .issue-card {
      background-color: var(--card);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .issue-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      border-color: var(--primary);
    }

    .issue-header {
      background: linear-gradient(135deg,
          var(--lite-secondary1) 0%,
          var(--lite-secondary2) 100%);
      color: white;
      padding: 1.5rem;
    }

    .journal-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .issue-meta {
      display: flex;
      align-items: center;
      gap: 1rem;
      font-size: 0.875rem;
      opacity: 0.9;
    }

    .issue-content {
      padding: 1.5rem;
    }

    .issue-date {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--muted-foreground);
      font-size: 0.875rem;
      margin-bottom: 1rem;
    }

    .issue-title {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 1rem;
      line-height: 1.4;
      color: var(--foreground);
    }

    .issue-abstract {
      color: var(--muted-foreground);
      font-size: 0.95rem;
      line-height: 1.6;
      margin-bottom: 1.5rem;
      max-height: 120px;
      overflow: hidden;
      position: relative;
    }

    .issue-abstract::after {
      content: "...";
      position: absolute;
      bottom: 0;
      right: 0;
      background: var(--card);
      padding-left: 1rem;
    }

    .authors-section {
      margin-bottom: 1.5rem;
    }

    .authors-label {
      font-size: 0.875rem;
      color: var(--muted-foreground);
      margin-bottom: 0.5rem;
      display: block;
    }

    .authors-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .author-tag {
      background-color: rgba(14, 107, 167, 0.1);
      color: var(--lite-secondary1);
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 500;
      border: 1px solid rgba(14, 107, 167, 0.2);
    }

    .issue-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 1rem;
      border-top: 1px solid var(--border);
    }

    .more-papers {
      color: var(--primary);
      font-size: 0.875rem;
      font-weight: 500;
    }

    /* Loading States */
    .loading {
      text-align: center;
      padding: 3rem;
      color: var(--muted-foreground);
      grid-column: 1 / -1;
    }

    .loading i {
      font-size: 2rem;
      margin-bottom: 1rem;
      color: var(--primary);
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      100% {
        transform: rotate(360deg);
      }
    }

    .no-data {
      text-align: center;
      padding: 3rem;
      color: var(--muted-foreground);
      grid-column: 1 / -1;
    }

    .no-data i {
      font-size: 3rem;
      margin-bottom: 1rem;
      color: var(--muted-foreground);
      opacity: 0.5;
    }

    /* Pagination */
    .pagination {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 3rem;
      padding: 2rem 0;
    }

    .page-btn {
      padding: 0.5rem 1rem;
      border: 1px solid var(--border);
      background-color: var(--background);
      border-radius: var(--radius);
      cursor: pointer;
      font-weight: 500;
      font-size: 0.875rem;
      transition: all 0.2s;
    }

    .page-btn:hover {
      border-color: var(--primary);
      background-color: rgba(31, 27, 81, 0.1);
    }

    .page-btn.active {
      background-color: var(--primary);
      color: var(--primary-foreground);
      border-color: var(--primary);
    }

    /* Global Loader */
    .global-loader {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.8);
      z-index: 2000;
      backdrop-filter: blur(4px);
    }

    .global-loader.hidden {
      display: none;
    }

    .loader-box {
      background: var(--card);
      padding: 1.5rem 2rem;
      border-radius: var(--radius);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      display: flex;
      gap: 1rem;
      align-items: center;
      font-weight: 600;
      color: var(--foreground);
    }

    .loader-box i {
      font-size: 1.5rem;
      animation: spin 1s linear infinite;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .nav-links {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background-color: var(--background);
        flex-direction: column;
        padding: 1.5rem;
        border-bottom: 1px solid var(--border);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      }

      .nav-links.active {
        display: flex;
      }

      .mobile-menu-btn {
        display: block;
      }

      .page-hero h1 {
        font-size: 2.5rem;
      }

      .filters-grid {
        grid-template-columns: 1fr;
      }

      .filter-actions {
        flex-direction: column;
      }

      .filter-actions .btn {
        width: 100%;
      }

      .issues-grid {
        grid-template-columns: 1fr;
      }

      .auth-buttons {
        flex-direction: column;
        width: 100%;
      }

      .auth-buttons a {
        width: 100%;
        text-align: center;
      }
    }

    @media (max-width: 1024px) {
      .page-hero h1 {
        font-size: 3rem;
      }
    }

    /* Animation */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fade-in {
      animation: fadeIn 0.6s ease forwards;
    }

    .auth-buttons a{
      padding: .8rem !important;
      border-radius: 10px;
    }
  </style>
</head>

<body>
  <!-- Header -->
  <header id="header">
  </header>
  <script src="js/header.js"></script>

  <!-- Page Hero -->
  <section class="page-hero">
    <div class="container">
      <div class="breadcrumb fade-in">
        <a href="index.html">Home</a> / <span>Latest Issues</span>
      </div>
      <div class="page-hero-content fade-in">
        <h1>Latest Journal Issues</h1>
        <p>
          Browse our collection of published issues across all academic
          journals. Discover cutting-edge research and scholarly articles.
        </p>
      </div>
    </div>
  </section>

  <!-- Filters Section -->
  <section class="container">
    <div class="filters-section fade-in">
      <div class="filters-grid">
        <div class="filter-group">
          <label for="searchInput"><i class="fas fa-search"></i> Search</label>
          <div class="search-box">
            <input type="text" id="searchInput" placeholder="Search issues, titles, or abstracts..." />
            <i class="fas fa-search"></i>
          </div>
        </div>

        <div class="filter-group">
          <label><i class="fas fa-sort-numeric-up"></i> Volume</label>
          <div class="custom-dropdown" id="volumeDropdown">
            <div class="dropdown-toggle" onclick="toggleDropdown('volume')">
              <span id="volumeText">All Volumes</span>
              <i class="fas fa-chevron-down"></i>
            </div>
            <div class="dropdown-menu" id="volumeMenu">
              <div class="dropdown-search">
                <input type="text" placeholder="Search volumes..." oninput="filterDropdown('volume', this.value)" />
              </div>
              <div class="dropdown-item selected" onclick="selectDropdownItem('volume', '', 'All Volumes')">
                All Volumes
              </div>
              <!-- Volumes will be populated dynamically -->
            </div>
          </div>
        </div>

        <div class="filter-group">
          <label><i class="fas fa-hashtag"></i> Issue Number</label>
          <div class="custom-dropdown" id="issueDropdown">
            <div class="dropdown-toggle" onclick="toggleDropdown('issue')">
              <span id="issueText">All Issues</span>
              <i class="fas fa-chevron-down"></i>
            </div>
            <div class="dropdown-menu" id="issueMenu">
              <div class="dropdown-search">
                <input type="text" placeholder="Search issues..." oninput="filterDropdown('issue', this.value)" />
              </div>
              <div class="dropdown-item selected" onclick="selectDropdownItem('issue', '', 'All Issues')">
                All Issues
              </div>
              <!-- Issues will be populated dynamically -->
            </div>
          </div>
        </div>

        <div class="filter-group">
          <label><i class="fas fa-calendar"></i> Publication Year</label>
          <div class="custom-dropdown" id="yearDropdown">
            <div class="dropdown-toggle" onclick="toggleDropdown('year')">
              <span id="yearText">All Years</span>
              <i class="fas fa-chevron-down"></i>
            </div>
            <div class="dropdown-menu" id="yearMenu">
              <div class="dropdown-search">
                <input type="text" placeholder="Search years..." oninput="filterDropdown('year', this.value)" />
              </div>
              <div class="dropdown-item selected" onclick="selectDropdownItem('year', '', 'All Years')">
                All Years
              </div>
              <!-- Years will be populated dynamically -->
            </div>
          </div>
        </div>
      </div>

      <div class="filter-actions">
        <button onclick="applyFilters()" class="btn btn-primary">
          <i class="fas fa-filter"></i> Apply Filters
        </button>
        <button onclick="clearFilters()" class="btn btn-outline">
          <i class="fas fa-times"></i> Clear Filters
        </button>
      </div>
    </div>
  </section>

  <!-- Issues Grid -->
  <section class="issues-section container">
    <div class="issues-grid" id="issuesGrid">
      <div class="loading">
        <i class="fas fa-spinner"></i>
        <p>Loading issues...</p>
      </div>
    </div>
    <div id="pagination" class="pagination"></div>
  </section>

  <!-- Footer -->
  <footer id="footer">

  </footer>
  <script src="js/footer.js"></script>

  <!-- Global Loader -->
  <div id="globalLoader" class="global-loader hidden">
    <div class="loader-box">
      <i class="fas fa-spinner"></i>
      <div>Loading...</div>
    </div>
  </div>


  <script>
    // Configuration
    const BASE_URL = "https://fp.247laboratory.net/api/v1"; // Update this with your actual API base URL
    const ITEMS_PER_PAGE = 9;

    // State management
    let currentPage = 1;
    let allIssues = [];
    let filterOptions = {
      volumes: new Set(),
      issues: new Set(),
      years: new Set(),
    };
    let selectedFilters = {
      search: "",
      volume: "",
      issueNumber: "",
      year: "",
    };

    // DOM Elements
    const mobileMenuBtn = document.getElementById("mobileMenuBtn");
    const navLinks = document.querySelector(".nav-links");
    const globalLoader = document.getElementById("globalLoader");

    // Mobile menu toggle
    mobileMenuBtn.addEventListener("click", () => {
      navLinks.classList.toggle("active");
      const icon = mobileMenuBtn.querySelector("i");
      icon.classList.toggle("fa-bars");
      icon.classList.toggle("fa-times");
    });

    // Close mobile menu when clicking outside
    document.addEventListener("click", (e) => {
      if (!navLinks.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
        navLinks.classList.remove("active");
        const icon = mobileMenuBtn.querySelector("i");
        icon.classList.remove("fa-times");
        icon.classList.add("fa-bars");
      }
    });

    // Loader functions
    function showLoading() {
      globalLoader.classList.remove("hidden");
    }

    function hideLoading() {
      globalLoader.classList.add("hidden");
    }

    // Initialize page
    document.addEventListener("DOMContentLoaded", async () => {
      try {
        showLoading();
        await loadAllIssues();
        await loadIssues();
      } finally {
        hideLoading();
      }
    });

    // Fetch all issues for filter dropdowns
    async function loadAllIssues() {
      try {
        const url = `${BASE_URL}/public/issues?limit=100&page=1`;
        const res = await fetch(url);
        const data = await res.json();

        if (data.success && data.issues) {
          allIssues = data.issues;

          // Extract filter options
          data.issues.forEach((issue) => {
            if (issue.volume) filterOptions.volumes.add(issue.volume);
            if (issue.issueNumber)
              filterOptions.issues.add(issue.issueNumber);
            if (issue.publicationDate) {
              const year = new Date(issue.publicationDate).getFullYear();
              filterOptions.years.add(year);
            }
          });

          // Populate dropdowns
          populateDropdown(
            "volume",
            Array.from(filterOptions.volumes).sort((a, b) => a - b)
          );
          populateDropdown(
            "issue",
            Array.from(filterOptions.issues).sort((a, b) => a - b)
          );
          populateDropdown(
            "year",
            Array.from(filterOptions.years).sort((a, b) => b - a)
          );
        }
      } catch (err) {
        console.error("Error loading all issues:", err);
        showNotification("Error loading filter options", "error");
      }
    }

    function populateDropdown(type, items) {
      const menu = document.getElementById(`${type}Menu`);
      items.forEach((item) => {
        const text =
          type === "year"
            ? String(item)
            : type === "volume"
              ? `Volume ${item}`
              : `Issue ${item}`;
        const value = String(item);

        const div = document.createElement("div");
        div.className = "dropdown-item";
        div.textContent = text;
        div.onclick = () => selectDropdownItem(type, value, text);
        menu.appendChild(div);
      });
    }

    // Dropdown functionality
    function toggleDropdown(type) {
      const menu = document.getElementById(`${type}Menu`);
      const toggle = document.querySelector(
        `#${type}Dropdown .dropdown-toggle`
      );

      // Close other dropdowns
      document.querySelectorAll(".dropdown-menu").forEach((m) => {
        if (m !== menu) m.classList.remove("show");
      });
      document.querySelectorAll(".dropdown-toggle").forEach((t) => {
        if (t !== toggle) t.classList.remove("active");
      });

      // Toggle current dropdown
      menu.classList.toggle("show");
      toggle.classList.toggle("active");
    }

    function filterDropdown(type, searchTerm) {
      const menu = document.getElementById(`${type}Menu`);
      const items = menu.querySelectorAll(".dropdown-item");
      const search = searchTerm.toLowerCase();

      items.forEach((item) => {
        const text = item.textContent.toLowerCase();
        item.style.display = text.includes(search) ? "block" : "none";
      });
    }

    async function selectDropdownItem(type, value, text) {
      document.getElementById(`${type}Text`).textContent = text;

      // Update selected filters
      if (type === "volume") selectedFilters.volume = value;
      if (type === "issue") selectedFilters.issueNumber = value;
      if (type === "year") selectedFilters.year = value;

      // Update visual selection
      const menu = document.getElementById(`${type}Menu`);
      menu.querySelectorAll(".dropdown-item").forEach((item) => {
        item.classList.remove("selected");
      });

      const selectedItem = Array.from(
        menu.querySelectorAll(".dropdown-item")
      ).find((item) => item.textContent === text);
      if (selectedItem) selectedItem.classList.add("selected");

      // Close dropdown
      menu.classList.remove("show");
      document
        .querySelector(`#${type}Dropdown .dropdown-toggle`)
        .classList.remove("active");

      // Reload issues
      currentPage = 1;
      try {
        showLoading();
        await loadIssues(currentPage);
      } finally {
        hideLoading();
      }
    }

    // Load issues with pagination
    async function loadIssues(page = 1) {
      const issuesGrid = document.getElementById("issuesGrid");
      const pagination = document.getElementById("pagination");

      // Show loading state
      issuesGrid.innerHTML = `
                <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <p>Loading issues...</p>
                </div>
            `;
      pagination.innerHTML = "";

      try {
        // Build query parameters
        const params = new URLSearchParams();
        params.append("limit", ITEMS_PER_PAGE.toString());
        params.append("page", page.toString());

        if (selectedFilters.search)
          params.append("search", selectedFilters.search);
        if (selectedFilters.volume)
          params.append("volume", selectedFilters.volume);
        if (selectedFilters.issueNumber)
          params.append("issueNumber", selectedFilters.issueNumber);
        if (selectedFilters.year) params.append("year", selectedFilters.year);

        const url = `${BASE_URL}/public/issues?${params.toString()}`;
        const res = await fetch(url);
        const data = await res.json();

        if (data.success && data.issues && data.issues.length > 0) {
          renderIssues(data.issues);
          renderPagination(page, data.totalPages || 1);
        } else {
          showNoData();
        }
      } catch (err) {
        console.error("Error loading issues:", err);
        showError();
      }
    }

    function renderIssues(issues) {
      const issuesGrid = document.getElementById("issuesGrid");

      if (issues.length === 0) {
        showNoData();
        return;
      }

      const issuesHTML = issues
        .map((issue) => {
          const firstSubmission = issue.submissions?.[0];
          const pubDate = issue.publicationDate
            ? new Date(issue.publicationDate).toLocaleDateString("en-US", {
              year: "numeric",
              month: "long",
              day: "numeric",
            })
            : "Not published";

          const abstract = stripHtml(
            firstSubmission?.abstract ||
            issue.title ||
            "No abstract available."
          );
          const authors = firstSubmission?.authors || [];
          const authorsHTML =
            authors.length > 0
              ? `
                    <div class="authors-section">
                        <span class="authors-label">Authors:</span>
                        <div class="authors-tags">
                            ${authors
                .slice(0, 3)
                .map(
                  (a) =>
                    `<span class="author-tag">${a.name || "Anonymous"
                    }</span>`
                )
                .join("")}
                            ${authors.length > 3
                ? `<span class="author-tag">+${authors.length - 3
                } more</span>`
                : ""
              }
                        </div>
                    </div>
                `
              : "";

          const downloadBtn = firstSubmission?.file
            ? `
                    <a href="${BASE_URL}/public/download/${firstSubmission._id}" class="btn btn-primary btn-sm" target="_blank">
                        <i class="fas fa-download"></i> Download
                    </a>
                `
            : "";

          const morePapers =
            issue.submissions?.length > 1
              ? `<span class="more-papers">+${issue.submissions.length - 1
              } more papers</span>`
              : "";

          return `
                    <div class="issue-card fade-in">
                        <div class="issue-header">
                            <div class="journal-title">${issue.journal?.title || "Journal"
            }</div>
                            <div class="issue-meta">
                                <span><i class="fas fa-hashtag"></i> Vol. ${issue.volume || "N/A"
            }, Issue ${issue.issueNumber || "N/A"}</span>
                            </div>
                        </div>
                        <div class="issue-content">
                            <div class="issue-date">
                                <i class="far fa-calendar"></i> ${pubDate}
                            </div>
                            <h3 class="issue-title">${firstSubmission?.title ||
            issue.title ||
            "Untitled"
            }</h3>
                            <div class="issue-abstract">${abstract}</div>
                            ${authorsHTML}
                            <div class="issue-actions">
                                ${downloadBtn}
                                ${morePapers}
                            </div>
                        </div>
                    </div>
                `;
        })
        .join("");

      issuesGrid.innerHTML = issuesHTML;
    }

    function stripHtml(html) {
      if (!html) return "";
      const stripped = html.replace(/<[^>]*>/g, "");
      return stripped.length > 200
        ? stripped.substring(0, 200) + "..."
        : stripped;
    }

    function renderPagination(current, total) {
      const pagination = document.getElementById("pagination");

      if (!total || total <= 1) {
        pagination.innerHTML = "";
        return;
      }

      let html = "";

      // Previous button
      if (current > 1) {
        html += `<button class="page-btn" onclick="changePage(${current - 1
          })">
                    <i class="fas fa-chevron-left"></i>
                </button>`;
      }

      // Page numbers
      for (let i = 1; i <= total; i++) {
        if (
          i === 1 ||
          i === total ||
          (i >= current - 1 && i <= current + 1)
        ) {
          html += `<button class="page-btn ${i === current ? "active" : ""
            }" onclick="changePage(${i})">${i}</button>`;
        } else if (i === current - 2 || i === current + 2) {
          html += `<span class="page-btn">...</span>`;
        }
      }

      // Next button
      if (current < total) {
        html += `<button class="page-btn" onclick="changePage(${current + 1
          })">
                    <i class="fas fa-chevron-right"></i>
                </button>`;
      }

      pagination.innerHTML = html;
    }

    // Filter functions
    function applyFilters() {
      const searchInput = document.getElementById("searchInput");
      selectedFilters.search = searchInput.value.trim();
      currentPage = 1;

      try {
        showLoading();
        loadIssues(currentPage);
      } finally {
        hideLoading();
      }
    }

    function clearFilters() {
      // Reset filter inputs
      document.getElementById("searchInput").value = "";
      document.getElementById("volumeText").textContent = "All Volumes";
      document.getElementById("issueText").textContent = "All Issues";
      document.getElementById("yearText").textContent = "All Years";

      // Reset selected filters
      selectedFilters = { search: "", volume: "", issueNumber: "", year: "" };

      // Reset dropdown selections
      document.querySelectorAll(".dropdown-item").forEach((item) => {
        item.classList.remove("selected");
      });

      // Re-select "All" options
      document
        .querySelectorAll(".dropdown-menu .dropdown-item:first-child")
        .forEach((item) => {
          item.classList.add("selected");
        });

      // Reload issues
      currentPage = 1;
      try {
        showLoading();
        loadIssues(currentPage);
      } finally {
        hideLoading();
      }
    }

    function changePage(page) {
      currentPage = page;
      try {
        showLoading();
        loadIssues(page);
      } finally {
        hideLoading();
      }
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    // Error and empty states
    function showNoData() {
      const issuesGrid = document.getElementById("issuesGrid");
      issuesGrid.innerHTML = `
                <div class="no-data fade-in">
                    <i class="fas fa-newspaper"></i>
                    <h3>No Issues Found</h3>
                    <p>Try adjusting your search filters</p>
                    <button onclick="clearFilters()" class="btn btn-outline" style="margin-top: 1rem;">
                        <i class="fas fa-times"></i> Clear Filters
                    </button>
                </div>
            `;
      document.getElementById("pagination").innerHTML = "";
    }

    function showError() {
      const issuesGrid = document.getElementById("issuesGrid");
      issuesGrid.innerHTML = `
                <div class="no-data fade-in">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>Error Loading Issues</h3>
                    <p>Please try again later</p>
                    <button onclick="loadIssues()" class="btn btn-primary" style="margin-top: 1rem;">
                        <i class="fas fa-redo"></i> Try Again
                    </button>
                </div>
            `;
      document.getElementById("pagination").innerHTML = "";
    }

    // Close dropdowns when clicking outside
    document.addEventListener("click", (e) => {
      if (!e.target.closest(".custom-dropdown")) {
        document.querySelectorAll(".dropdown-menu").forEach((menu) => {
          menu.classList.remove("show");
        });
        document.querySelectorAll(".dropdown-toggle").forEach((toggle) => {
          toggle.classList.remove("active");
        });
      }
    });

    // Utility function for notifications
    function showNotification(message, type = "info") {
      // You can implement a toast notification system here
      console.log(`${type.toUpperCase()}: ${message}`);
    }

    // Make functions globally available
    window.applyFilters = applyFilters;
    window.clearFilters = clearFilters;
    window.changePage = changePage;
    window.toggleDropdown = toggleDropdown;
    window.filterDropdown = filterDropdown;
    window.selectDropdownItem = selectDropdownItem;
  </script>
</body>

</html>